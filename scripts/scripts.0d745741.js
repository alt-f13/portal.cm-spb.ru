"use strict";var $app=angular.module("angularTestApp",["ngAnimate","ngResource","ngRoute","ngSanitize","SimpleCouch","ui.bootstrap","ngMaterial","elasticui","elasticsearch","siyfion.sfTypeahead"]).config(["$routeProvider","$httpProvider","couchConfigProvider",function(a,b,c){a.when("/brand/:id",{templateUrl:"views/brand.html",controller:"BrandCtrl",controllerAs:"brand"}).when("/posts",{templateUrl:"views/posts.html",controller:"PostsCtrl",controllerAs:"posts"}).when("/part/:id",{templateUrl:"views/part.html",controller:"PartCtrl",controllerAs:"part"}).otherwise({redirectTo:"/posts"}),"localhost"===location.hostname?c.setServer("/db"):c.setServer("https://couch.2d-it.ru"),c.setDB("fara")}]).constant("euiHost","http://elastic.2d-it.ru"),db_name="gbook";angular.module("angularTestApp").controller("MainCtrl",["$scope","$filter","couchdb",function(a,b,c){var d=a.$db=c;a.session=function(){d.user.session(function(b){console.log("session",b),a.isAuthenticated()})},a.isAuthenticated=function(){d.user.isAuthenticated(function(b){console.log("isAuthenticated",b),a.$emit("authenticated",b),a.$broadcast("authenticated",b),a.authenticated=b})},a.logout=function(){d.user.logout(function(b){console.log(b),a.isAuthenticated()})}}]),angular.module("angularTestApp").filter("trust",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("angularTestApp").controller("PostsCtrl",["$scope","couchdb",function(a,b){a.$db=b;a.hits=new Array,a.docUrl="/db/"+a.$db.db.getName(),a.indexVM.pageSize=50,a.$watch(a.indexVM.page,function(b,c,d){console.log(a.indexVM),a.hits.apply(a.indexVM.results.hits.hits)},!0),a.nextPage=function(){a.indexVM.page=a.indexVM.page+1,a.hits=a.hits.concat(a.indexVM.results.hits.hits),console.log(a.hits.length),a.$apply()}}]),angular.module("angularTestApp").controller("BrandCtrl",["$scope","couchdb","$routeParams",function(a,b,c){a.$db=b;a.docUrl=a.$db.config.getServer()+"/"+a.$db.db.getName()+"/"+c.id+"/",a.loadBrand=function(){a.$db.view("db","parts",{key:c.id,limit:30},function(b){a.list=b,console.log(b)})},a.loadBrand()}]),angular.module("angularTestApp").controller("PartCtrl",["$scope","couchdb","$routeParams",function(a,b,c){var d=a.$db=b;a.loadPart=function(){d.doc.get(c.id,function(b){a.part=b,console.log(b)})},a.loadPart()}]),angular.module("angularTestApp").directive("replaceSpace",function(){return{template:"<div></div>",restrict:"E",link:function(a,b,c){b.text("this is the replaceSpace directive")}}}),angular.module("angularTestApp").filter("removeSpace",[function(){return function(a){return angular.isString(a)?a.replace(/[\s]/g,"_"):a}}]),angular.module("elasticsearch",[]).factory("esFactory",["$http","$q",function(a,b){return function(c){return{search:function(d){var e=b.defer(),f=b.defer();return a({method:"POST",url:c.host+"/"+d.index+"/_search",params:{size:d.size,from:d.from},data:d.body.toJSON(),timeout:e.promise}).then(function(a){f.resolve(a.data)},function(){f.reject.apply(this,arguments)}),f.promise.abort=function(){e.resolve()},f.promise["finally"](function(){f.promise.abort=angular.noop,e=f=null}),f.promise}}}}]),angular.module("angularTestApp").filter("join",function(){return function(a){return a.join(" ")}}),angular.module("angularTestApp").run(["$templateCache",function(a){a.put("views/about.html",'<div class="list-group" ng-repeat="post in posts"> <a href="#" class="list-group-item active"> <h4 class="list-group-item-heading">List group item heading</h4> <p class="list-group-item-text">...</p> </a> </div>'),a.put("views/brand.html",'<div class="list-group"> <a class="list-group-item" ng-href="#/part/{{part.id}}" ng-repeat="part in list"> {{part.value.title}} {{part.id}} <span class="badge">{{part.value.price}}</span> </a> </div>'),a.put("views/links.html",'<ul> <li ng-repeat="doc in docs"> <a href="{{doc.value.href}}" class="link-icon">{{doc.value.title}}</a> </li> </ul> <form ng-submit="submitEntry()"> <div class="row"> <div class="col-md-3"> <div class="input-group"> <span class="input-group-addon" style="cursor: pointer"> <i class="fa fa-lg fa-anchor"></i> </span> <input class="form-control" type="text" ng-model="link.title" placeholder="Название"> </div> </div> <div class="col-md-3"> <div class="input-group"> <span class="input-group-addon" style="cursor: pointer"> <i class="fa fa-lg fa-link"></i> </span> <input class="form-control" type="text" ng-model="link.href" placeholder="href"> </div> </div> <div class="col-md-3"></div> <div class="col-md-3"> <button type="button" class="btn btn-primary" ng-click="submitEntry()">Сохранить</button> </div> </div> </form> <script type="text/ng-template" id="edit.html"><form role="form" name="formdetails" class="offset1 span9" ng-submit="submitEntry()">\n  <div class="modal-header">\n    <div class="row">\n      <div class="col-md-8">\n        <div class="input-group">\n          <span class="input-group-addon">\n            <input type="checkbox" aria-label="опубликованно" ng-model="details.published">\n          </span>\n          <input type="text" class="form-control" placeholder="Название" aria-describedby="basic-addon1" ng-model="details.title">\n        </div><!-- /input-group -->\n      </div>\n      <div class="col-md-2">\n          <div class="input-group">\n            <span class="input-group-addon" style="cursor: pointer">\n                <i class="fa fa-lg fa-calendar"></i>\n            </span>\n            <datepicker date-format="dd/MM/yyyy">\n              <input class="form-control" type="text" ng-model="details.date" placeholder="Choose a date"/>\n            </datepicker>\n\n          </div>\n      </div>\n      <div class="col-md-1">\n        <button type="button" class="btn btn-primary" ng-click="submitEntry()">Сохранить</button>\n      </div>\n      <div class="col-md-1">\n        <button type="button" class="close"  ng-click="close() " aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      </div>\n\n    </div>\n\n  </div>\n  <div class="modal-body ">\n\n    <div class="row edit">\n      <div class="col-md-10">\n        <div class="form-group">\n           <text-angular  ng-model="details.body" ></text-angular>\n        </div>\n      </div>\n      <div class="col-md-2 attachments"  ngf-drop ng-model="files"\n          ngf-drag-over-class="\'dragover\'" ngf-multiple="true" ngf-allow-dir="true"\n          accept="image/*,application/pdf"\n          ngf-pattern="\'image/*,application/pdf\'">\n        <ul>\n          <li>\n\n                    <div  ngf-drop ngf-select ng-model="files" class="drop-box"\n                        ngf-drag-over-class="\'dragover\'" ngf-multiple="true" ngf-allow-dir="true"\n                        accept="image/*,application/pdf"\n                        ngf-pattern="\'image/*,application/pdf\'">Drag-drop сюда или нажмите для загрузки</div>\n                    <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div>\n          </li>\n          <li ng-repeat="(name,info) in details._attachments" >\n            <div class="thumbnail" ng-switch="info.content_type==\'image/png\'||info.content_type==\'image/jpeg\'">\n              <img ng-switch-when="true" ng-switch-when-separator="|" src="{{docUrl}}{{name}}" alt="">\n              <div class="caption">\n                {{name}}\n              </div>\n            </div>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-default" ng-click="close()">Закрыть</button>\n    <button type="button" class="btn btn-primary" ng-click="submitEntry()">Сохранить</button>\n  </div>\n</form></script>'),a.put("views/login.html",""),a.put("views/part.html",'<div class="container"> <div class="jumbotron"> <div class="row"> {{part.title}}{{part._id}} </div> <div class="row"> <div class="col-md-6">{{part.img}}</div> <div class="col-md-6"> {{part.info}}<br> {{part.price}}<br> {{part.model}} </div> </div> </div> </div>'),a.put("views/post.html",'<form role="form" name="formdetails" class="offset1 span9" ng-submit="submitEntry()"> <fieldset> <div class="form-group"> <label for="detailsAlias">Название</label> <input type="text" id="mewEntryAlias" class="span4 form-control" ng-model="details.title" required> </div> <div class="form-group"> <label for="detailsEmail">Дата</label> <input type="text" id="detailsEmail" class="span4 form-control" ng-model="details.date"> </div> <div class="form-group"> <label for="detailsSubject">теги</label> <input type="text" id="detailsSubject" class="span9 form-control" ng-model="details.tags" required> </div> <div class="form-group"> <label for="detailsBody">Послание</label> <textarea rows="5" id="detailsBody" class="span9 form-control" ng-model="details.body"></textarea> </div> </fieldset> <button class="btn" data-dismiss="modal">Close</button> <button class="btn btn-primary" type="submit">Submit</button> </form> <ul ng-repeat="(name,info) in details._attachments"> <li><img src="{{docUrl}}{{name}}" alt=""></li> </ul> <input type="text" ng-model="username"><br><br> watching model: <div class="button" ngf-select ng-model="file" ngf-multiple="false">Select File</div> on file change multiple: <div class="button" ngf-select="upload($files)" ngf-multiple="true">Select File</div> Drop File: <div ngf-drop ngf-select ng-model="files" class="drop-box" ngf-drag-over-class="\'dragover\'" ngf-multiple="true" ngf-allow-dir="true" accept="image/*,application/pdf" ngf-pattern="\'image/*,application/pdf\'">Drop pdfs or images here or click to upload</div> <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div> Files: <ul> <li ng-repeat="f in files" style="font:smaller">{{f.name}} {{f.$error}} {{f.$errorParam}}</li> </ul> Upload Log: <pre>{{log}}</pre> '),a.put("views/posts.html",'<div class="container-fluid"> <div class="row"> <div class="col-xs-3 col-md-3 sidebar"> <h3>Поиск</h3> <!-- <eui-searchbox field="\'info\'"></eui-searchbox> --> <input type="text" eui-query="ejs.MatchQuery(\'title\', querystring)" ng-model="querystring" eui-enabled="querystring.length"> <h3>Производитель:</h3> <ul class="nav nav-list" eui-aggregation="ejs.TermsAggregation(\'field\').field(\'brand\').size(65)"> <li ng-repeat="bucket in aggResult.buckets"> <label class="checkbox" eui-filter="ejs.TermsFilter(\'brand\', bucket.key)"> <span class="ng-scope"> <a href="" ng-click="filter.enabled=true" class="ng-binding"> <img ng-src="/images/logos/{{bucket.key|lowercase|removeSpace}}.gif"> {{bucket.key|uppercase}} <span class="muted ng-binding"> ({{bucket.doc_count}})</span> <a href="" ng-click="filter.enabled=false" ng-show="filter.enabled" class="facet-remove">x</a> </a> </span> </label> </li> </ul> <!-- ACTION: change to field to use as facet --> <h4>Модель:</h4> <!-- <eui-checklist field="\'model\'" size="100"></eui-checklist> --> <ul ng-show="indexVM.filters.jsonObjects.length>0" ng-show="filter.enabled" class="nav nav-list" eui-aggregation="ejs.TermsAggregation(\'model\').field(\'model\').size(25)"> <li ng-repeat="bucket in aggResult.buckets"> <label class="checkbox" eui-filter="ejs.TermsFilter(\'model\', bucket.key)"> <input type="checkbox" ng-model="filter.enabled"> {{bucket.key}} ({{bucket.doc_count}}) </label> </li> </ul> <h5>Кузов</h5> <ul ng-show="indexVM.filters.jsonObjects.length>1" class="nav nav-list" eui-aggregation="ejs.TermsAggregation(\'base\').field(\'price\').size(25)"> <li ng-repeat="bucket in aggResult.buckets"> <label class="checkbox" eui-filter="ejs.TermsFilter(\'base\', bucket.key)"> <input type="checkbox" ng-model="filter.enabled"> {{bucket.key}} ({{bucket.doc_count}}) </label> </li> </ul> <!-- ACTION: change to field to use as facet --> <!-- <h3>Results Per Page</h3>\n            <select ng-model="indexVM.pageSize">\n                <option ng-repeat="item in [10, 20, 50, 100]">{{item}}</option>\n            </select> --> </div> <div class="col-xs-9 main"> <div class="list-group"> <a class="list-group-item" ng-href="#/part/{{part._id}}" ng-repeat="part in indexVM.results.hits.hits"> <!-- {{part|json}} --> <img ng-src="{{docUrl}}/{{part._id}}/image0.jpg" ng-if="part._source._attachments" alt=""> {{part._source.title|join}} <span class="badge">{{part._source.price*1.25}}</span> </a> </div> <!-- <div infinite-scroll="nextPage()" infinite-scroll-distance="3"></div> --> <ul class="pager"> <li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">Previous</a></li> <li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">Next</a></li> </ul> </div> </div> </div>'),a.put("views/scheduler.html",'<div class="container"> <h2>Расписание <span class="pull-right">{{_doc.date}}</span><h2> </h2></h2></div> <div class="container-fluid" ng-controller="SchedulerCtrl"> <div class="row"> <div class="col-md-2"> <div pickmeup></div> </div> <div class="col-md-10"> <hot-table hot-id="my-handsontable" datarows="_doc.grid.data" settings="settings" col-headers="_doc.grid.columns" row-headers="true" mergecells="_doc.grid.mergeCells"> <hot-column ng-repeat="column in _doc.grid.columns" title="column" renderer="validRenderer" read-only="!authenticated"></hot-column> </hot-table> </div> </div> </div>')}]);